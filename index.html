<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="None">
  
  
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>lzhw</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "lzhw (DataFrame Compression)";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> lzhw</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href=".">lzhw (DataFrame Compression)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#how-lzhw-works">How lzhw Works</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#lempel-ziv77-with-huffman-coding">Lempel-Ziv77 with Huffman Coding</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#better-than-huffman-alone">Better than Huffman Alone</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#deflate-note">DEFLATE Note</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#putting-all-together-with-lzhw-class">Putting all together with LZHW Class</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="1%20Quick%20Start/">Quick Start</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="2%20Compressing%20DataFrames/">Compressing DataFrames in Parallel</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="3%20%28De%29Compressing%20Specific%20columns%20or%20rows%20from%20a%20dataframe/">(De)Compressing specific columns or rows from a dataframe</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="4%20More%20Compression%20Functions/">More Compression Functions</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="5%20Using%20the%20lzhw%20command%20line%20tool/">Using the lzhw Command Line tool</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="6%20LZHW%20Comparison/">6 LZHW Comparison</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">lzhw</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>lzhw (DataFrame Compression)</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="lzhw-dataframe-compression">lzhw (DataFrame Compression)</h1>
<p><strong>Compression library for data frames and tabular data files, csv, excel etc.</strong></p>
<p><img alt="lzhw logo" src="img/lzhw_logo.jpg" /></p>
<p><a href="https://travis-ci.com/MNoorFawi/lzhw"><img alt="Build Status" src="https://travis-ci.com/MNoorFawi/lzhw.svg?branch=master" /></a></p>
<p><strong>Compression</strong> library to compress big lists and/or pandas dataframes using an <strong>optimized algorithm (lzhw)</strong> developed from Lempel-Ziv, Huffman and LZ-Welch techniques.</p>
<p><strong>lzhw has a command line tool that can be downloaded from <a href="https://drive.google.com/file/d/1CBu7Adb5CHZUwhANa_i8Es0-8jSWAmiC/view?usp=sharing">here</a> and can work from command line with no prior python installation.</strong></p>
<p><strong>Manual on how to use it available <a href="https://mnoorfawi.github.io/lzhw/5%20Using%20the%20lzhw%20command%20line%20tool/">here</a></strong>.</p>
<p>It works on Windows and soon a Mac version will be available.</p>
<h2 id="how-lzhw-works">How lzhw Works</h2>
<h4 id="overview">Overview</h4>
<p>The library's main goal is to compress data frames, excel and csv files so that they consume less space to overcome memory errors.
Also to enable dealing with large files that can cause memory errors when reading them in python or that cause slow operations.
With <strong>lzhw</strong>, we can read compressed files and do operations <strong>column by column</strong> only on columns that we are interesred in. </p>
<p>The algorithm is a mix of the famous <strong>lempel-ziv and huffman coding</strong> algorithm with some use of <strong>lempel-ziv-welch</strong> algorithm.
The algorithm starts with an input stream for example this one:</p>
<pre><code class="python">example = [&quot;to&quot;, &quot;be&quot;, &quot;or&quot;, &quot;not&quot;, &quot;to&quot;, &quot;be&quot;, &quot;or&quot;, &quot;to&quot;, &quot;be&quot;, &quot;or&quot;, &quot;not&quot;] * 2
print(&quot;&quot;.join(example))
# tobeornottobeortobeornottobeornottobeortobeornot
</code></pre>

<h4 id="lempel-ziv77-with-huffman-coding">Lempel-Ziv77 with Huffman Coding</h4>
<p><strong>lzhw</strong> uses <a href="https://en.wikipedia.org/wiki/LZ77_and_LZ78"><strong>lempel-ziv77</strong></a> to discover repeated sequences in the stream and construct <em>triplets</em>, in that format &lt;<strong>offset,length,literal</strong>&gt;. 
Where <em>offset</em> is how many steps should we return back word to find the beginning of the current sequence and <em>length</em> is how many steps should we move and <em>literal</em> is the next value after the sequence.</p>
<p>Then we will have 3 shorter lists representing the stream, where <a href="https://en.wikipedia.org/wiki/Huffman_coding"><strong>Huffman Coding</strong></a> can come to the game encoding them.</p>
<p>The function that performs lempel-ziv and returning the triplets called <strong>lz77_compress</strong>.</p>
<pre><code class="python">import lzhw
lz77_ex = lzhw.lz77_compress(example)
print(lz77_ex)
# [(None, None, 'to'), (None, None, 'be'), (None, None, 'or'), 
# (None, None, 'not'), (4, 3, 'to'), (7, 6, 'not'), (11, 6, 'not')]
</code></pre>

<p>Here all the <strong>None</strong>s values are originally "0s" but converted to None to save more space.</p>
<p>Now huffman coding will take the offsets list, lengths list and literal list and encode them based on most occurring values to give:</p>
<pre><code class="python">lz77_lists = list(zip(*lz77_ex))
print(lz77_lists)
# [(None, None, None, None, 4, 7, 11), 
#  (None, None, None, None, 3, 6, 6), 
#  ('to', 'be', 'or', 'not', 'to', 'not', 'not')]

huffs = []
from collections import Counter
for i in range(len(lz77_lists)):
    huff = lzhw.huffman_coding(Counter(lz77_lists[i]))
    huffs.append(huff)
print(huffs)
# [{None: '1', 4: '010', 7: '011', 11: '00'}, {None: '1', 3: '00', 6: '01'}, 
#  {'to': '11', 'be': '100', 'or': '101', 'not': '0'}]
</code></pre>

<p>Now if we encode each value in the triplets with its corresponding value from the huffman dictionary and append everything together we will have:</p>
<pre><code class="python">bits = []
for i in range(len(huffs)):
    bit = &quot;&quot;.join([huffs[i].get(k) for k in lz77_lists[i]])
    bits.append(bit)
print(bits)
# ['111101001100', '1111000101', '1110010101100']

print(len(&quot;&quot;.join(bits)))
# 35
</code></pre>

<p>Which has a length of <strong>35</strong> bits only!</p>
<p>Then <a href="https://en.wikipedia.org/wiki/Lempel%E2%80%93Ziv%E2%80%93Welch">Lempel-Ziv-Welch</a>, <strong>lzw_compress()</strong>, is used to further compress the dictionaries produces by Huffman. </p>
<h4 id="better-than-huffman-alone">Better than Huffman Alone</h4>
<p>Using each algorithm alone can give us bigger number of bits, for example, using only huffman coding will give us:</p>
<pre><code class="python">huff_alone = lzhw.huffman_coding(Counter(example))
print(huff_alone)
# {'to': '11', 'be': '01', 'or': '10', 'not': '00'}

huff_bit = &quot;&quot;.join([huff_alone.get(k) for k in example])
print(huff_bit)
# 11011000110110110110001101100011011011011000

print(len(huff_bit))
# 44
</code></pre>

<p>44 bits, 9 more bit!!! Big deal when dealing with bigger data.</p>
<h4 id="deflate-note">DEFLATE Note</h4>
<p>The techniques may seem similar to the <a href="https://en.wikipedia.org/wiki/DEFLATE"><strong>DEFLATE</strong></a> algorithm which uses both LZSS, which is a variant of LZ77, and huffman coding, but I am not sure how the huffman coding further compresses the triplets. I believe it compresses the triplets altogether not as 3 separate lists as lzhw.
 And also it doesn't use the lempel-ziv-welch for further compression.</p>
<p>DEFLATE Algorithm may be more complicated than lzhw, discussed here, but the latter is designed specifically for <strong>tabular data</strong> types to help in <strong>data science</strong> and <strong>data analysis</strong> projects.</p>
<h4 id="putting-all-together-with-lzhw-class">Putting all together with LZHW Class</h4>
<p>All of the steps can be done at once using <strong>LZHW</strong> class as follows and as shown in the Quick Start section:</p>
<pre><code class="python">lzhw_comp = lzhw.LZHW(example)
print(lzhw_comp.compressed)
# (8012, 1989, 15532) # this is how the compressed data looks like and stored

print(lzhw_comp.sequences) 
# {'offset': {3: None, 10: 4, 11: 7, 4: 11}, 
#  'length': {3: None, 4: 3, 5: 6}, 
#  'literal_str': {7: 321647, 12: 312421, 13: 319090, 2: 163110516}}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="1%20Quick%20Start/" class="btn btn-neutral float-right" title="Quick Start">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="1%20Quick%20Start/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.1
Build Date UTC : 2020-06-21 09:17:33
-->
